# Дорожная карта

## Фаза 0 — Стабилизация базы (0.5–1 нед)
- Почистить старые входные точки; запуск через `app.main`/`app.main_step2`.
- Проверить экспорт CSV, фильтры, кэш цен, офлайн-поведение.
- Добавить индексы БД; кнопка/скрипт бэкапа.

**Критерий:** стабильный запуск, корректные позиции/PnL, рабочий экспорт.

## Фаза 1 — Алерты и аналитика (1–3 нед)
- Модель `AlertRule` + CRUD в UI.
- Планировщик (APScheduler): price/unreal_abs/unreal_pct + cooldown.
- История срабатываний + уведомления в UI.
- Аналитика: мини-графики 7/30д; локальный кэш истор. цен.

**Критерий:** алерты без «дребезга», графики строятся быстро.

## Фаза 2 — Импорт и Saved Views (3–4 нед)
- Импорт CSV: маппинг, предпросмотр (dry-run), batch-вставка, нормализация чисел/дат.
- Saved Views: сохранение/выбор пресетов фильтров/колонок.

**Критерий:** импорт 5–10k строк стабильно, пресеты работают.

## Фаза 3 — Мультипортфели и капитал (4–6 нед)
- `Portfolio` + миграция → `default`, селектор активного портфеля.
- Capital Management: конфиг «лестницы», подсказки.

**Критерий:** отчёты разделяются по портфелям, подсказки отображаются.

## Фаза 4 — Точность и долговечность (6–8 нед)
- Decimal в моделях/сервисах; форматтер чисел.
- Тесты (pytest): FIFO/PNL, адаптер цен.
- Zip-backup/restore и (опц.) PyInstaller .exe.

**Критерий:** тесты зелёные; сборка запускается на «чистой» машине.
