# Crypto Portfolio ‚Äî Local

–õ–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É—á—ë—Ç–∞ –∫—Ä–∏–ø—Ç–æ–ø–æ—Ä—Ç—Ñ–µ–ª—è –±–µ–∑ –ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤: —Ö—Ä–∞–Ω–∏—Ç —Å–¥–µ–ª–∫–∏, —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –ø–æ FIFO, —Å—á–∏—Ç–∞–µ—Ç PnL, —Ç—è–Ω–µ—Ç —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã (CoinGecko), –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–¥–∫—É –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows 11 –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–°–¥–µ–ª–∫–∏**: –ø–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞/–æ–±–º–µ–Ω/–¥–µ–ø–æ–∑–∏—Ç/–≤—ã–≤–æ–¥, –ø–æ–ª–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (long/mid/short/scalp), –∏—Å—Ç–æ—á–Ω–∏–∫ (–±–∏—Ä–∂–∞/–∫–æ—à–µ–ª—ë–∫), –∑–∞–º–µ—Ç–∫–∏.
- **–ü–æ–∑–∏—Ü–∏–∏**: –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ `(coin, strategy)` –ø–æ **FIFO**, —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, —Å—Ç–æ–∏–º–æ—Å—Ç—å, –Ω–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PnL.
- **–¶–µ–Ω—ã**: CoinGecko *Simple Price* —Å –∫—ç—à–µ–º 60 —Å–µ–∫—É–Ω–¥.
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –≤–∫–ª–∞–¥–∫–∏ *Overview / Positions / Transactions*, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–º–æ–Ω–µ—Ç–∞/—Å—Ç—Ä–∞—Ç–µ–≥–∏—è), —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫.
- **–≠–∫—Å–ø–æ—Ä—Ç**: CSV –¥–ª—è —Å–¥–µ–ª–æ–∫ –∏ –ø–æ–∑–∏—Ü–∏–π.
- **–ë—ç–∫–∞–ø—ã –ë–î**: –≤ `data/backups` (–≤—ã–∑–æ–≤ –∏–∑ —Å–µ—Ä–≤–∏—Å–∞; –∫–Ω–æ–ø–∫—É –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å).

## –°—Ç–µ–∫
Python 3.13, NiceGUI, SQLite + SQLModel/SQLAlchemy, httpx, python-dotenv.

`requirements.txt`:

```
nicegui
sqlmodel
sqlalchemy
aiosqlite
pydantic>=2
httpx
python-dotenv
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Windows)
1. –£—Å—Ç–∞–Ω–æ–≤–∏ Python 3.13 (–¥–æ–±–∞–≤—å –≤ PATH).
2. –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
   - –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫: `setup_once.bat`
   - –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞): `run_dev.bat`
   - –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º: `run_prod.bat`
3. –û—Ç–∫—Ä–æ–π `http://127.0.0.1:8080`.

`.env` (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):

```
APP_PORT=8080
REPORT_CURRENCY=USD
LOCAL_TIMEZONE=Europe/Moscow
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
main.py # –∑–∞–≥—Ä—É–∑–∫–∞ UI, —Ä–æ—É—Ç—ã NiceGUI
ui/pages.py # –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –≤–∫–ª–∞–¥–∫–∏, —Ñ–æ—Ä–º—ã, —Ç–∞–±–ª–∏—Ü—ã
core/models.py # –º–æ–¥–µ–ª–∏ SQLModel –∏ DTO
core/services.py # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: CRUD, FIFO, PnL, —ç–∫—Å–ø–æ—Ä—Ç CSV
adapters/prices.py # CoinGecko Simple Price (+–∫—ç—à 60—Å)
storage/db.py # –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SQLite (data/portfolio.db)
data/
backups/ # –±—ç–∫–∞–ø—ã
exports/ # —ç–∫—Å–ø–æ—Ä—Ç CSV
.vscode/launch.json # –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø—É—Å–∫–∞ –¥–ª—è VS Code/Cursor
setup_once.bat / run_dev.bat / run_prod.bat
requirements.txt
```

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
`Transaction` (SQLModel, —Ç–∞–±–ª–∏—Ü–∞):
- `id: int PK`
- `coin: str` (UPPER)
- `type: str` ‚Äî `buy | sell | exchange_in | exchange_out | deposit | withdrawal`
- `quantity: float` *(–ø–ª–∞–Ω: Decimal)*
- `price: float` ‚Äî —Ü–µ–Ω–∞ –≤ –≤–∞–ª—é—Ç–µ –æ—Ç—á—ë—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é USD)
- `ts_utc: datetime` (UTC now)
- `strategy: str` ‚Äî `long | mid | short | scalp`
- `source: str | None`, `notes: str | None`

DTO `TransactionIn` ‚Äî –¥–ª—è –≤–≤–æ–¥–∞.

## FIFO –∏ PnL
- –ü–æ–∑–∏—Ü–∏—è –∫–ª—é—á—É–µ—Ç—Å—è –∫–∞–∫ **(coin, strategy)** ‚Äî —Ä–∞–∑–¥–µ–ª—è–µ–º –¥–æ–ª–≥–æ—Å—Ä–æ–∫/—Å—Ä–µ–¥–Ω–∏–π/–∫—Ä–∞—Ç–∫–æ—Å—Ä–æ–∫/—Å–∫–∞–ª—å–ø–∏–Ω–≥.
- –ü—Ä–∏—Ö–æ–¥ (`buy`, `exchange_in`, `deposit`) –¥–æ–±–∞–≤–ª—è–µ—Ç –ª–æ—Ç—ã `{qty, price}`.
- –†–∞—Å—Ö–æ–¥ (`sell`, `exchange_out`, `withdrawal`) —Å–ø–∏—Å—ã–≤–∞–µ—Ç FIFO, **—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PnL** = `qty * (sell_price - lot_price)`.
- –ü–æ–∑–∏—Ü–∏—è = —Å—É–º–º–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –ª–æ—Ç–æ–≤; `avg_cost = cost_basis / qty`.
- **–ù–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PnL** = `qty * price_now - cost_basis`; `% = (price_now - avg_cost) / avg_cost * 100`.

## –ê–¥–∞–ø—Ç–µ—Ä —Ü–µ–Ω
`adapters/prices.py`:
- CoinGecko `/api/v3/simple/price?ids={id}&vs_currencies={quote}`
- –∫–∞—Ä—Ç–∞ —Ç–∏–∫–µ—Ä–æ–≤ ‚Üí id (`BTC->bitcoin`, `XLM->stellar`, ‚Ä¶)
- –∫—ç—à –≤ –ø–∞–º—è—Ç–∏ 60—Å, —Ç–∞–π–º–∞—É—Ç 8—Å, –æ—à–∏–±–∫–∏ ‚Üí `None`.

## UI (NiceGUI)
- **Overview** ‚Äî —Å–≤–æ–¥–∫–∞ (Total Value, Unrealized/Realized PnL) + —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–∑–∏—Ü–∏–π.
- **Positions** ‚Äî —Ç–µ –∂–µ –ø–æ–∑–∏—Ü–∏–∏, –∫–Ω–æ–ø–∫–∞ ¬´–≠–∫—Å–ø–æ—Ä—Ç –ø–æ–∑–∏—Ü–∏–π (CSV)¬ª.
- **Transactions** ‚Äî —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, —Ç–∞–±–ª–∏—Ü–∞ —Å ‚úèÔ∏è—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º/üóëÔ∏è—É–¥–∞–ª–µ–Ω–∏–µ–º, ¬´–≠–∫—Å–ø–æ—Ä—Ç —Å–¥–µ–ª–æ–∫ (CSV)¬ª.
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã**: –ø–æ –º–æ–Ω–µ—Ç–µ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –ø–æ–∑–∏—Ü–∏—è–º –∏ —Å–¥–µ–ª–∫–∞–º.
- –í–≤–æ–¥—ã —Å `autocomplete=off` (—á—Ç–æ–±—ã Edge Wallet –Ω–µ –≤–º–µ—à–∏–≤–∞–ª—Å—è).

## –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞
**–ò—Ç–µ—Ä–∞—Ü–∏—è 1:** Alerts (APScheduler), Analytics (–º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫–∏ + –∫—ç—à –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Ü–µ–Ω), Import CSV (–º–∞–ø–ø–∏–Ω–≥ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä), Saved Views.  
**–ò—Ç–µ—Ä–∞—Ü–∏—è 2:** Multi-portfolio (—Ç–∞–±–ª–∏—Ü–∞ `Portfolio`, FK –≤ `Transaction`), Capital Management (–ª–µ—Å—Ç–Ω–∏—Ü–∞ –∑–∞–∫—É–ø–æ–∫ + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã).  
**–ò—Ç–µ—Ä–∞—Ü–∏—è 3:** Decimal –≤–º–µ—Å—Ç–æ float, pytest-—Ç–µ—Å—Ç—ã, zip-backup, PyInstaller.

## –ù—é–∞–Ω—Å—ã
- –†–∞–Ω–µ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ ‚Üí `ImportError`. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: `export_transactions_csv` –∏ `export_positions_csv` –µ—Å—Ç—å –≤ `app/core/services.py`.
- Edge Wallet –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ (`autocomplete=off`).
